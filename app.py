# -*- coding: utf-8 -*-
"""app.py.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1U8AqTSGCWljdYBlFEeyHqkBGqglSrKMR
"""
import joblib
import pandas as pd
import numpy as np
import joblib
import os

st.set_page_config(page_title="Car Evaluation Predictor", layout="centered")
st.title("Car Evaluation Prediction")
st.write("Predict car acceptability (class) based on features using a Random Forest model.")

# Load saved model and encoders
MODEL_PATH = "car_rf_model.pkl"
ENC_PATH = "encoders_dict.pkl"

if not os.path.exists(MODEL_PATH) or not os.path.exists(ENC_PATH):
    st.error("Model or encoders not found. Make sure car_rf_model.pkl and encoders_dict.pkl exist in this folder.")
else:
    model = joblib.load(MODEL_PATH)
    encoders = joblib.load(ENC_PATH)  # dict: column_name -> LabelEncoder

    # Input widgets (these options are standard for Car Evaluation dataset)
    buying = st.selectbox("Buying Price", ["vhigh", "high", "med", "low"])
    maint = st.selectbox("Maintenance Price", ["vhigh", "high", "med", "low"])
    doors = st.selectbox("Doors", ["2", "3", "4", "5more"])
    persons = st.selectbox("Capacity (persons)", ["2", "4", "more"])
    lug_boot = st.selectbox("Luggage Boot", ["small", "med", "big"])
    safety = st.selectbox("Safety", ["low", "med", "high"])

    # Prepare input dataframe
    user_df = pd.DataFrame({
        "buying": [buying],
        "maint": [maint],
        "doors": [doors],
        "persons": [persons],
        "lug_boot": [lug_boot],
        "safety": [safety]
    })

    # Encode user input using saved encoders
    try:
        for col in user_df.columns:
            if col in encoders:
                le_col = encoders[col]
                # Match unseen categories: fallback to -1 (or try mapping)
                try:
                    user_df[col] = le_col.transform(user_df[col].astype(str))
                except ValueError:
                    # If unseen, append to classes then transform (best done offline)
                    classes = list(le_col.classes_) + [user_df[col].iloc[0]]
                    le_col.classes_ = np.array(classes)
                    user_df[col] = le_col.transform(user_df[col].astype(str))
            else:
                # If encoder not found, try simple mapping or leave as is
                pass

        # Reorder columns to match training
        X_cols = model.feature_names_in_ if hasattr(model, "feature_names_in_") else list(user_df.columns)
        user_df = user_df[X_cols]

        if st.button("Predict"):
            pred = model.predict(user_df)[0]
            # If you saved label mapping for target, decode it. Here we assume numeric classes map to strings in original dataset.
            st.success(f"Predicted class: {pred}")
            st.write("Note: class values are encoded integers (0,1,2,...) matching dataset encoding.")
    except Exception as e:
        st.error(f"Encoding or prediction error: {e}")

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
# import streamlit as st
# import pickle
# import numpy as np
# 
# # Load model
# model = pickle.load(open("car_rf_model.pkl", "rb"))
# encoders = pickle.load(open("encoders_dict.pkl", "rb"))
# 
# st.title("Car Evaluation Prediction App")
# 
# # User Inputs
# buying = st.selectbox("Buying Price", encoders['buying'].classes_)
# maint = st.selectbox("Maintenance Cost", encoders['maint'].classes_)
# doors = st.selectbox("Doors", encoders['doors'].classes_)
# persons = st.selectbox("Persons Capacity", encoders['persons'].classes_)
# lug_boot = st.selectbox("Lug Boot Size", encoders['lug_boot'].classes_)
# safety = st.selectbox("Safety Level", encoders['safety'].classes_)
# 
# # Convert input to numbers
# input_data = []
# for col, val in zip(encoders.keys(), [buying, maint, doors, persons, lug_boot, safety]):
#     input_data.append(encoders[col].transform([val])[0])
# 
# prediction = model.predict([input_data])[0]
# 
# st.success(f"Predicted Car Evaluation: {prediction}")
#
